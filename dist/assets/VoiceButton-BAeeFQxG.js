import{j as e,_ as I,v as B,z as x}from"./index-mfTr1OfE.js";import{r as a}from"./react-BKEbDJhF.js";import{m as r,A as j}from"./motion-BaJTjmjD.js";import{p as F,a0 as R,Z as L,o as P,V as q,a1 as Q,i as H}from"./icons-5Lq8eyna.js";import"./vendor-CmZZtmkI.js";const oe=({onVoiceInput:A,isListening:O=!1})=>{const[s,c]=a.useState("ready"),[b,S]=a.useState(0),[y,V]=a.useState(""),[D,N]=a.useState(0),[Y,T]=a.useState([]),[Z,k]=a.useState(!1),g=a.useRef(null),w=a.useRef([]),u=a.useRef(null),f=a.useRef(null),d=a.useRef(),m=a.useRef(null),U=async()=>{"speechSynthesis"in window&&speechSynthesis.cancel(),document.querySelectorAll("audio").forEach(o=>{o.pause(),o.currentTime=0}),k(!1),T([]);try{const{analytics:o}=await I(async()=>{const{analytics:n}=await import("./analytics-CDfcVRap.js");return{analytics:n}},[]);o.trackUserEngagement("voice_barge_in",{action:"User interrupted audio playback"})}catch(o){console.warn("Analytics tracking failed:",o)}},_=async()=>{try{if(U(),!B.isAllowed("voice_recording")){const i=Math.ceil((B.getResetTime("voice_recording")-Date.now())/6e4);x.error(`تم تجاوز عدد المحاولات. حاول مرة أخرى خلال ${i} دقيقة`);return}const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3,channelCount:1}});u.current=t,w.current=[];const o=new AudioContext,n=o.createAnalyser();o.createMediaStreamSource(t).connect(n),n.fftSize=256,f.current=n;const p=new MediaRecorder(t,{mimeType:MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm"});g.current=p,p.ondataavailable=i=>{i.data.size>0&&w.current.push(i.data)},p.onstop=async()=>{const i=new Blob(w.current,{type:p.mimeType});await M(i)},p.start(100),c("recording"),N(0),v(),m.current=setInterval(()=>{N(i=>i>=300?(h(),i):i+1)},1e3)}catch(t){console.error("Error accessing microphone:",t);let o="لا يمكن الوصول للميكروفون";t.name==="NotAllowedError"?o="يرجى السماح بالوصول للميكروفون من إعدادات المتصفح":t.name==="NotFoundError"&&(o="لم يتم العثور على ميكروفون"),x.error(o)}},h=()=>{g.current&&s==="recording"&&(g.current.stop(),c("processing"),u.current&&u.current.getTracks().forEach(t=>t.stop()),d.current&&cancelAnimationFrame(d.current),m.current&&clearInterval(m.current))},v=()=>{if(!f.current||s!=="recording")return;const t=new Uint8Array(f.current.frequencyBinCount);f.current.getByteFrequencyData(t);const o=t.reduce((n,z)=>n+z)/t.length;S(Math.min(o*2,100)),d.current=requestAnimationFrame(v)},M=async t=>{try{if(c("processing"),t.size>10*1024*1024)throw new Error("حجم التسجيل كبير جداً");if(t.size<1e3)throw new Error("التسجيل قصير جداً، يرجى المحاولة مرة أخرى");await new Promise(n=>setTimeout(n,2e3));const o="أريد إنشاء تطبيق توصيل طعام صحي في الرياض يستهدف العائلات الشابة";V(o),c("playing"),await new Promise(n=>setTimeout(n,3e3)),c("completed"),A(o),x.success("تم تحويل الصوت بنجاح")}catch(o){console.error("Voice processing error:",o),x.error(o.message||"خطأ في معالجة الصوت"),c("ready")}},$=()=>{switch(s==="ready"&&U(),s){case"ready":_();break;case"recording":h();break;case"completed":c("ready"),V(""),N(0);break}},E=t=>{const o=Math.floor(t/60),n=t%60;return`${o}:${n.toString().padStart(2,"0")}`},l=(()=>{switch(s){case"ready":return{color:"bg-saudi-green",icon:H,text:"🎤 تحدث معي",pulse:!1};case"recording":return{color:"bg-red-500",icon:R,text:`🔴 ${E(D)} - اضغط للإيقاف`,pulse:!0};case"processing":return{color:"bg-yellow-500",icon:Q,text:"⚙️ جاري المعالجة...",pulse:!1};case"playing":return{color:"bg-blue-500",icon:q,text:"🔊 يشغل الرد...",pulse:!0};case"completed":return{color:"bg-green-500",icon:P,text:"✅ انتهى - اضغط للبدء مرة أخرى",pulse:!1}}})(),C=l.icon;return a.useEffect(()=>()=>{u.current&&u.current.getTracks().forEach(t=>t.stop()),d.current&&cancelAnimationFrame(d.current),m.current&&clearInterval(m.current)},[]),e.jsxDEV(e.Fragment,{children:[e.jsxDEV(r.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:260,damping:20},className:"fixed bottom-8 left-8 z-50",children:[e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(j,{children:s==="recording"&&e.jsxDEV(e.Fragment,{children:[...Array(3)].map((t,o)=>e.jsxDEV(r.div,{className:"absolute inset-0 border-4 border-saudi-green/30 rounded-full",initial:{scale:1,opacity:.7},animate:{scale:[1,1.5,2],opacity:[.7,.3,0]},transition:{duration:2,repeat:1/0,delay:o*.5}},o,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:307,columnNumber:19},void 0))},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:305,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:303,columnNumber:11},void 0),e.jsxDEV(r.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:$,className:`w-20 h-20 rounded-full shadow-2xl transition-all duration-300 relative overflow-hidden cursor-pointer ${l.color} ${l.pulse?"animate-pulse":""}`,"aria-pressed":s==="recording","aria-live":"polite","aria-label":l.text,children:[e.jsxDEV(j,{mode:"wait",children:e.jsxDEV(r.div,{initial:{opacity:0,rotate:-90},animate:{opacity:1,rotate:0},exit:{opacity:0,rotate:90},transition:{duration:.3},children:e.jsxDEV(C,{className:`h-8 w-8 text-white mx-auto ${s==="processing"?"animate-spin":""}`},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:343,columnNumber:17},void 0)},s,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:336,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:335,columnNumber:13},void 0),s==="recording"&&e.jsxDEV(r.div,{className:"absolute bottom-0 left-0 right-0 bg-white/20 transition-all duration-100",style:{height:`${Math.min(b,100)}%`},animate:{opacity:[.5,1,.5]},transition:{duration:.5,repeat:1/0}},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:349,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:326,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:301,columnNumber:9},void 0),e.jsxDEV(r.div,{className:"text-center mt-2",animate:s==="recording"?{y:[0,-2,0]}:{},transition:{duration:1,repeat:s==="recording"?1/0:0},children:e.jsxDEV("span",{className:"bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-almarai font-bold text-gray-700 shadow-lg",children:l.text},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:365,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:360,columnNumber:9},void 0),s==="recording"&&e.jsxDEV("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 flex gap-1","aria-live":"polite",children:[...Array(5)].map((t,o)=>e.jsxDEV("div",{className:"wave w-1 bg-saudi-green rounded-full",style:{animationDelay:`${o*.1}s`,height:`${Math.max(8,b/5)}px`}},o,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:374,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:372,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:295,columnNumber:7},void 0),e.jsxDEV(j,{children:(s==="recording"||s==="processing"||s==="playing")&&e.jsxDEV(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-40",children:e.jsxDEV(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-3xl p-8 max-w-lg w-full mx-4 shadow-2xl",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:`w-24 h-24 ${l.color} rounded-full mx-auto mb-6 flex items-center justify-center relative`,children:[e.jsxDEV(C,{className:`h-12 w-12 text-white ${s==="processing"?"animate-spin":""}`},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:405,columnNumber:19},void 0),s==="recording"&&e.jsxDEV(e.Fragment,{children:[...Array(3)].map((t,o)=>e.jsxDEV(r.div,{className:"absolute inset-0 border-4 border-white/30 rounded-full",animate:{scale:[1,1.5,2],opacity:[.7,.3,0]},transition:{duration:2,repeat:1/0,delay:o*.5}},o,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:411,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:409,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:404,columnNumber:17},void 0),e.jsxDEV(r.h3,{className:"text-2xl font-almarai font-bold text-gray-800 mb-3",animate:s==="recording"?{scale:[1,1.02,1]}:{},transition:{duration:2,repeat:s==="recording"?1/0:0},children:[s==="recording"&&"أتحدث الآن... أنا أسمعك 👂",s==="processing"&&"جاري معالجة الصوت...",s==="playing"&&"يشغل رد المستشار..."]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:429,columnNumber:17},void 0),e.jsxDEV("p",{className:"text-gray-600 font-almarai mb-6",children:[s==="recording"&&"تحدث بوضوح عن فكرة مشروعك، أهدافك، والسوق المستهدف",s==="processing"&&"يرجى الانتظار بينما نحول صوتك إلى نص ونحلل المحتوى",s==="playing"&&"استمع لرد المستشار الذكي"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:439,columnNumber:17},void 0),s==="recording"&&e.jsxDEV(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsxDEV("div",{className:"flex items-center justify-center gap-2",children:[e.jsxDEV("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:453,columnNumber:23},void 0),e.jsxDEV("span",{className:"font-almarai font-bold text-red-700",children:E(D)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:454,columnNumber:23},void 0),e.jsxDEV("span",{className:"font-almarai text-red-600 text-sm",children:"/ 5:00"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:457,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:452,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:447,columnNumber:19},void 0),s==="recording"&&e.jsxDEV(r.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center justify-center gap-1 mb-6",children:[...Array(20)].map((t,o)=>e.jsxDEV(r.div,{className:"w-1 bg-saudi-green rounded-full transition-all duration-100",style:{height:`${b>o*5?Math.random()*40+10:5}px`},animate:{opacity:b>o*5?[.5,1,.5]:.3},transition:{duration:.3}},o,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:472,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:466,columnNumber:19},void 0),e.jsxDEV(j,{children:y&&e.jsxDEV(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-light-green rounded-2xl p-4 mb-6 text-right",children:[e.jsxDEV("div",{className:"flex items-center justify-end gap-2 mb-2",children:[e.jsxDEV("span",{className:"font-almarai font-bold text-saudi-green",children:"ما تقوله الآن:"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:497,columnNumber:25},void 0),e.jsxDEV(F,{className:"h-5 w-5 text-saudi-green"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:500,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:496,columnNumber:23},void 0),e.jsxDEV("p",{className:"text-saudi-green font-almarai text-lg",children:['"',y,'"']},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:502,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:490,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:488,columnNumber:17},void 0),s==="recording"&&e.jsxDEV(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center gap-4",children:e.jsxDEV(r.button,{onClick:h,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-red-500 text-white px-6 py-3 rounded-xl font-almarai font-bold hover:bg-red-600 transition-colors flex items-center gap-2",children:[e.jsxDEV(R,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:522,columnNumber:23},void 0),"إيقاف التسجيل"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:516,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:511,columnNumber:19},void 0),s==="recording"&&e.jsxDEV(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-6 bg-gray-50 rounded-xl p-4",children:[e.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxDEV(L,{className:"h-4 w-4 text-saudi-green"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:537,columnNumber:23},void 0),e.jsxDEV("span",{className:"font-almarai font-bold text-saudi-green text-sm",children:"نصائح للحصول على أفضل النتائج:"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:538,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:536,columnNumber:21},void 0),e.jsxDEV("div",{className:"space-y-1 text-xs font-almarai text-gray-600 text-right",children:[e.jsxDEV("p",{children:"• تحدث بوضوح واذكر نوع المشروع"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:541,columnNumber:23},void 0),e.jsxDEV("p",{children:"• اذكر المدينة المستهدفة ورأس المال المتوقع"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:542,columnNumber:23},void 0),e.jsxDEV("p",{children:"• وضح الجمهور المستهدف والمنافسين"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:543,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:540,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:530,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:402,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:396,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:390,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:388,columnNumber:7},void 0),e.jsxDEV("style",{jsx:!0,children:`
        .wave {
          animation: wave-animation 1s infinite ease-in-out;
        }
        .wave:nth-child(2) { animation-delay: 0.2s; }
        .wave:nth-child(3) { animation-delay: 0.4s; }
        .wave:nth-child(4) { animation-delay: 0.6s; }
        .wave:nth-child(5) { animation-delay: 0.8s; }
        
        @keyframes wave-animation {
          0%, 100% { transform: scaleY(0.5); }
          50% { transform: scaleY(1.3); }
        }
      `},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:554,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/VoiceButton.tsx",lineNumber:293,columnNumber:5},void 0)};export{oe as default};
