var b=Object.defineProperty;var f=(m,e,r)=>e in m?b(m,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[e]=r;var a=(m,e,r)=>f(m,typeof e!="symbol"?e+"":e,r);import{j as t}from"./index-mfTr1OfE.js";import{r as g}from"./react-BKEbDJhF.js";import{aj as x,a9 as j,aE as N,al as E,aF as w,ao as y,an as v}from"./icons-5Lq8eyna.js";import"./vendor-CmZZtmkI.js";import"./motion-BaJTjmjD.js";const c=class c{constructor(){a(this,"metrics",[]);a(this,"observers",[]);this.initializeObservers()}static getInstance(){return c.instance||(c.instance=new c),c.instance}initializeObservers(){if(!(typeof window>"u")&&"PerformanceObserver"in window){const e=new PerformanceObserver(o=>{o.getEntries().forEach(n=>{n.entryType==="navigation"&&this.recordNavigationMetrics(n)})});try{e.observe({entryTypes:["navigation"]}),this.observers.push(e)}catch(o){console.warn("Navigation observer not supported:",o)}const r=new PerformanceObserver(o=>{o.getEntries().forEach(n=>{n.entryType==="resource"&&this.recordResourceMetrics(n)})});try{r.observe({entryTypes:["resource"]}),this.observers.push(r)}catch(o){console.warn("Resource observer not supported:",o)}const s=new PerformanceObserver(o=>{o.getEntries().forEach(n=>{n.entryType==="paint"&&this.recordPaintMetrics(n)})});try{s.observe({entryTypes:["paint"]}),this.observers.push(s)}catch(o){console.warn("Paint observer not supported:",o)}}}recordNavigationMetrics(e){const r={loadTime:e.loadEventEnd-e.navigationStart,renderTime:e.domContentLoadedEventEnd-e.navigationStart,apiResponseTime:0,memoryUsage:this.getMemoryUsage(),errorRate:0};this.metrics.push(r),this.trimMetrics()}recordResourceMetrics(e){if(e.name.includes("/api/")){const r=e.responseEnd-e.requestStart;this.updateApiResponseTime(r)}}recordPaintMetrics(e){console.log(`${e.name}: ${e.startTime}ms`)}getMemoryUsage(){if("memory"in performance){const e=performance.memory;return e.usedJSHeapSize/e.jsHeapSizeLimit}return 0}updateApiResponseTime(e){if(this.metrics.length>0){const r=this.metrics[this.metrics.length-1];r.apiResponseTime=e}}trimMetrics(){this.metrics.length>100&&(this.metrics=this.metrics.slice(-100))}getAverageMetrics(){if(this.metrics.length===0)return{loadTime:0,renderTime:0,apiResponseTime:0,memoryUsage:0,errorRate:0};const e=this.metrics.reduce((s,o)=>({loadTime:s.loadTime+o.loadTime,renderTime:s.renderTime+o.renderTime,apiResponseTime:s.apiResponseTime+o.apiResponseTime,memoryUsage:s.memoryUsage+o.memoryUsage,errorRate:s.errorRate+o.errorRate}),{loadTime:0,renderTime:0,apiResponseTime:0,memoryUsage:0,errorRate:0}),r=this.metrics.length;return{loadTime:e.loadTime/r,renderTime:e.renderTime/r,apiResponseTime:e.apiResponseTime/r,memoryUsage:e.memoryUsage/r,errorRate:e.errorRate/r}}recordError(e,r){if(this.metrics.length>0){const s=this.metrics[this.metrics.length-1];s.errorRate+=1}this.reportError(e,r)}async reportError(e,r){try{const s={message:e.message,stack:e.stack,context:r||"unknown",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,metrics:this.getAverageMetrics()}}catch(s){console.warn("Error reporting failed:",s)}}getPerformanceReport(){const e=this.getAverageMetrics(),r=[];let s=100;return e.loadTime>3e3&&(r.push("تحسين سرعة تحميل الصفحة"),s-=20),e.apiResponseTime>2e3&&(r.push("تحسين سرعة استجابة API"),s-=15),e.memoryUsage>.8&&(r.push("تحسين استخدام الذاكرة"),s-=15),e.errorRate>.05&&(r.push("تقليل معدل الأخطاء"),s-=25),{metrics:e,recommendations:r,score:Math.max(0,s)}}destroy(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.metrics=[]}};a(c,"instance");let d=c;const u=d.getInstance();typeof window<"u"&&window.addEventListener("beforeunload",()=>{u.destroy()});const l=class l{constructor(){a(this,"errorQueue",[]);a(this,"isOnline",navigator.onLine);this.initializeErrorHandling(),this.initializeNetworkMonitoring()}static getInstance(){return l.instance||(l.instance=new l),l.instance}initializeErrorHandling(){window.addEventListener("error",e=>{this.captureError(e.error,"global_error",{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.captureError(new Error(e.reason),"unhandled_promise_rejection",{reason:e.reason})}),window.__SMARTSTART_ERROR_HANDLER__=(e,r)=>{this.captureError(e,"react_error",r)}}initializeNetworkMonitoring(){window.addEventListener("online",()=>{this.isOnline=!0,this.flushErrorQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}captureError(e,r="unknown",s={}){const o=`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:o,timestamp:new Date,error:e,context:r,userId:this.getCurrentUserId(),sessionId:this.getSessionId(),userAgent:navigator.userAgent,url:window.location.href,stackTrace:e.stack||"",severity:this.determineSeverity(e,r),tags:this.generateTags(e,r),metadata:{...s,performance:u.getAverageMetrics(),viewport:{width:window.innerWidth,height:window.innerHeight},timestamp:Date.now()}};return this.errorQueue.push(i),u.recordError(e,r),this.isOnline&&this.flushErrorQueue(),i.severity==="critical"&&this.logCriticalError(i),o}async flushErrorQueue(){if(this.errorQueue.length===0||!this.isOnline)return;const e=[...this.errorQueue];this.errorQueue=[];try{(await fetch("/api/v1/errors/batch",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await this.getAuthToken()}`},body:JSON.stringify({errors:e})})).ok||this.errorQueue.unshift(...e)}catch(r){console.warn("Failed to send error reports:",r),this.errorQueue.unshift(...e)}}determineSeverity(e,r){return r.includes("auth")||r.includes("payment")||r.includes("security")?"critical":e.name==="TypeError"||e.name==="ReferenceError"?"high":r.includes("api")||r.includes("network")?"medium":"low"}generateTags(e,r){const s=[r];return e.name&&s.push(e.name),e.message.includes("network")&&s.push("network"),e.message.includes("timeout")&&s.push("timeout"),e.message.includes("permission")&&s.push("permission"),s}logCriticalError(e){const r=JSON.parse(localStorage.getItem("critical_errors")||"[]");r.push({id:e.id,timestamp:e.timestamp,message:e.error.message,context:e.context}),r.length>50&&r.splice(0,r.length-50),localStorage.setItem("critical_errors",JSON.stringify(r))}getCurrentUserId(){var e;try{return(e=JSON.parse(localStorage.getItem("supabase.auth.token")||"{}").user)==null?void 0:e.id}catch{return}}getSessionId(){let e=sessionStorage.getItem("session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("session_id",e)),e}async getAuthToken(){try{const{data:{session:e}}=await window.supabase.auth.getSession();return(e==null?void 0:e.access_token)||""}catch{return""}}getErrorStats(){const e={},r={};return this.errorQueue.forEach(s=>{e[s.severity]=(e[s.severity]||0)+1,r[s.context]=(r[s.context]||0)+1}),{total:this.errorQueue.length,bySeverity:e,byContext:r,recent:this.errorQueue.slice(-10)}}clearErrorQueue(){this.errorQueue=[]}};a(l,"instance");let p=l;const h=p.getInstance();class z extends g.Component{constructor(){super(...arguments);a(this,"state",{hasError:!1});a(this,"handleReload",()=>{sessionStorage.clear(),window.location.reload()});a(this,"handleGoHome",()=>{this.setState({hasError:!1}),window.location.href="/"});a(this,"copyErrorDetails",()=>{var s,o,i;const r=`
خطأ في التطبيق - SmartStartAI
معرف الخطأ: ${this.state.errorId}
الوقت: ${new Date().toLocaleString("ar-SA")}
الرسالة: ${(s=this.state.error)==null?void 0:s.message}
المتصفح: ${navigator.userAgent}
الصفحة: ${window.location.href}

تفاصيل تقنية:
${(o=this.state.error)==null?void 0:o.stack}

معلومات المكون:
${(i=this.state.errorInfo)==null?void 0:i.componentStack}
    `.trim();navigator.clipboard.writeText(r).then(()=>{alert("تم نسخ تفاصيل الخطأ")}).catch(()=>{const n=document.createElement("textarea");n.value=r,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),alert("تم نسخ تفاصيل الخطأ")})});a(this,"reportToSupport",()=>{var o;const r=encodeURIComponent(`خطأ في التطبيق - ${this.state.errorId}`),s=encodeURIComponent(`
مرحباً فريق الدعم،

حدث خطأ في التطبيق:

معرف الخطأ: ${this.state.errorId}
الوقت: ${new Date().toLocaleString("ar-SA")}
الصفحة: ${window.location.href}
الرسالة: ${(o=this.state.error)==null?void 0:o.message}

يرجى المساعدة في حل هذه المشكلة.

شكراً لكم.
    `);window.open(`mailto:support@smartstart.sa?subject=${r}&body=${s}`)})}static getDerivedStateFromError(r){return{hasError:!0,error:r,errorId:h.captureError(r,"react_error_boundary")}}componentDidCatch(r,s){console.error("خطأ في التطبيق:",r,s),this.setState({error:r,errorInfo:s,errorId:h.captureError(r,"react_component_error",{componentStack:s.componentStack})}),this.props.onError&&this.props.onError(r,s),window.__SMARTSTART_ERROR_HANDLER__&&window.__SMARTSTART_ERROR_HANDLER__(r,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsxDEV("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-light-green flex items-center justify-center p-4",children:t.jsxDEV("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8 max-w-lg w-full",children:[t.jsxDEV("div",{className:"w-20 h-20 bg-red-100 rounded-full mx-auto mb-6 flex items-center justify-center",children:t.jsxDEV(x,{className:"h-10 w-10 text-red-600"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:131,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:130,columnNumber:13},this),t.jsxDEV("div",{className:"text-center mb-6",children:[t.jsxDEV("h2",{className:"text-2xl font-almarai font-bold text-gray-800 mb-4",children:"عذراً، حدث خطأ غير متوقع"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:136,columnNumber:15},this),t.jsxDEV("p",{className:"text-gray-600 font-almarai mb-4 leading-relaxed",children:"نعتذر عن هذا الإزعاج. فريقنا التقني تم إشعاره تلقائياً وسيعمل على حل المشكلة."},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:140,columnNumber:15},this),t.jsxDEV("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:t.jsxDEV("p",{className:"text-sm font-almarai text-gray-600",children:["معرف الخطأ: ",t.jsxDEV("span",{className:"font-mono text-gray-800",children:this.state.errorId},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:147,columnNumber:31},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:146,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:145,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:135,columnNumber:13},this),t.jsxDEV("div",{className:"space-y-3 mb-6",children:[t.jsxDEV("button",{onClick:this.handleReload,className:"w-full bg-gradient-to-r from-saudi-green to-saudi-gold text-white py-3 rounded-xl font-almarai font-bold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2",children:[t.jsxDEV(j,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:158,columnNumber:17},this),"إعادة تحميل الصفحة"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:154,columnNumber:15},this),t.jsxDEV("button",{onClick:this.handleGoHome,className:"w-full bg-white border-2 border-saudi-green text-saudi-green py-3 rounded-xl font-almarai font-bold hover:bg-light-green transition-all duration-300 flex items-center justify-center gap-2",children:[t.jsxDEV(N,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:166,columnNumber:17},this),"العودة للرئيسية"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:162,columnNumber:15},this),t.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxDEV("button",{onClick:this.copyErrorDetails,className:"bg-gray-100 text-gray-700 py-3 rounded-xl font-almarai font-bold hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2",children:[t.jsxDEV(E,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:175,columnNumber:19},this),"نسخ التفاصيل"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:171,columnNumber:17},this),t.jsxDEV("button",{onClick:this.reportToSupport,className:"bg-tech-blue text-white py-3 rounded-xl font-almarai font-bold hover:bg-tech-blue/90 transition-all duration-300 flex items-center justify-center gap-2",children:[t.jsxDEV(w,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:183,columnNumber:19},this),"إبلاغ الدعم"]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:179,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:170,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:153,columnNumber:13},this),t.jsxDEV("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxDEV("h3",{className:"font-almarai font-bold text-gray-800 mb-3 text-center",children:"إذا استمرت المشكلة، تواصل معنا:"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:191,columnNumber:15},this),t.jsxDEV("div",{className:"space-y-2",children:[t.jsxDEV("div",{className:"flex items-center justify-center gap-2 text-sm",children:[t.jsxDEV(y,{className:"h-4 w-4 text-saudi-green"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:197,columnNumber:19},this),t.jsxDEV("span",{className:"font-almarai text-gray-700",children:"920012345"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:198,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:196,columnNumber:17},this),t.jsxDEV("div",{className:"flex items-center justify-center gap-2 text-sm",children:[t.jsxDEV(v,{className:"h-4 w-4 text-saudi-green"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:202,columnNumber:19},this),t.jsxDEV("span",{className:"font-almarai text-gray-700",children:"support@smartstart.sa"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:203,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:201,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:195,columnNumber:15},this),t.jsxDEV("div",{className:"mt-3 text-center",children:t.jsxDEV("p",{className:"text-xs font-almarai text-gray-500",children:"🕐 دعم فني متاح 24/7 - نحن معك دائماً"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:208,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:207,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:190,columnNumber:13},this),this.state.error&&t.jsxDEV("details",{className:"mt-4",children:[t.jsxDEV("summary",{className:"cursor-pointer font-almarai font-bold text-gray-700 hover:text-gray-900",children:"تفاصيل تقنية (للمطورين)"},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:217,columnNumber:17},this),t.jsxDEV("div",{className:"mt-2 p-3 bg-gray-100 rounded-lg text-left",children:[t.jsxDEV("pre",{className:"text-xs text-gray-600 overflow-auto max-h-32",children:this.state.error.stack},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:221,columnNumber:19},this),this.state.errorInfo&&t.jsxDEV("pre",{className:"text-xs text-gray-600 overflow-auto max-h-32 mt-2",children:this.state.errorInfo.componentStack},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:225,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:220,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:216,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:128,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/User/Downloads/project-bolt-sb1-szjsaox8 (10)/project/src/components/ErrorBoundary.tsx",lineNumber:127,columnNumber:9},this):this.props.children}}export{z as default};
