var d=Object.defineProperty;var f=(n,r,t)=>r in n?d(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var p=(n,r,t)=>f(n,typeof r!="symbol"?r+"":r,t);import{z as i}from"./index-mfTr1OfE.js";const a=class a{constructor(){}static getInstance(){return a.instance||(a.instance=new a),a.instance}async chat(r){try{if(!r.trim())throw new Error("النص مطلوب");const t=await fetch("/.netlify/functions/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r.trim()})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`HTTP error! status: ${t.status}`)}return(await t.json()).text||"عذراً، لم أتمكن من فهم طلبك"}catch(t){throw console.error("Chat error:",t),i.error("خطأ في المحادثة مع حور"),t}}async speak(r){try{if(!r.trim())throw new Error("النص مطلوب");const t=await fetch("/.netlify/functions/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r.trim()})});if(!t.ok){const s=await t.json().catch(()=>({}));throw new Error(s.detail||`HTTP error! status: ${t.status}`)}const o=await t.blob(),e=URL.createObjectURL(o),c=new Audio(e);return new Promise((s,w)=>{c.onended=()=>{URL.revokeObjectURL(e),s()},c.onerror=()=>{URL.revokeObjectURL(e),w(new Error("خطأ في تشغيل الصوت"))},c.play().catch(w)})}catch(t){throw console.error("TTS error:",t),i.error("خطأ في تحويل النص إلى صوت"),t}}async speechToText(r){try{if(!r||r.size===0)throw new Error("ملف صوتي مطلوب");const t=await r.arrayBuffer(),o=btoa(String.fromCharCode(...new Uint8Array(t))),e=await fetch("/.netlify/functions/stt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioBase64:o,mime:r.type||"audio/webm"})});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||`HTTP error! status: ${e.status}`)}return(await e.json()).text||""}catch(t){throw console.error("STT error:",t),i.error("خطأ في تحويل الصوت إلى نص"),t}}async voiceChat(r){try{const t=await this.speechToText(r);if(!t.trim())throw new Error("لم أتمكن من فهم ما قلته، يرجى المحاولة مرة أخرى");const o=await this.chat(t);return await this.speak(o),{userText:t,hoorResponse:o}}catch(t){throw console.error("Voice chat error:",t),i.error(t.message||"خطأ في المحادثة الصوتية"),t}}async healthCheck(){try{return(await fetch("https://smartstartai-backend-production.up.railway.app/api/v1/chat/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"مرحبا",context:{sector:"test"}})})).ok}catch(r){return console.warn("Health check failed:",r),!1}}};p(a,"instance");let h=a;const T=h.getInstance();export{T as h};
